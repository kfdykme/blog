<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="TCP 滑动窗口 （流量控制） 拥塞控制 拥塞避免算法   网络模型 3次握手 4次挥手 timeout    滑动窗口 Client send ack send not ACK not send, ready to receive not send, not ready to  receive   Server rec, ack, not send to process rec not ACK">
<meta property="og:type" content="article">
<meta property="og:title" content="TCP">
<meta property="og:url" content="http://yoursite.com/2020/03/22/network/TCP/index.html">
<meta property="og:site_name" content="枋">
<meta property="og:description" content="TCP 滑动窗口 （流量控制） 拥塞控制 拥塞避免算法   网络模型 3次握手 4次挥手 timeout    滑动窗口 Client send ack send not ACK not send, ready to receive not send, not ready to  receive   Server rec, ack, not send to process rec not ACK">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-03-22T09:20:11.000Z">
<meta property="article:modified_time" content="2021-02-21T16:12:48.863Z">
<meta property="article:author" content="Kfdykme">
<meta property="article:tag" content="network">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/03/22/network/TCP/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>TCP | 枋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">枋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">This is my thrid blog web site.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/22/network/TCP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Kfdykme">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          TCP
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-22 17:20:11" itemprop="dateCreated datePublished" datetime="2020-03-22T17:20:11+08:00">2020-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-22 00:12:48" itemprop="dateModified" datetime="2021-02-22T00:12:48+08:00">2021-02-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h1><ul>
<li>滑动窗口 （流量控制）</li>
<li>拥塞控制<ul>
<li>拥塞避免算法</li>
</ul>
</li>
<li>网络模型</li>
<li>3次握手</li>
<li>4次挥手<ul>
<li>timeout</li>
</ul>
</li>
</ul>
<h2 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h2><ul>
<li>Client<ul>
<li>send ack</li>
<li>send not ACK</li>
<li>not send, ready to receive</li>
<li>not send, not ready to  receive</li>
</ul>
</li>
<li>Server<ul>
<li>rec, ack, not send to process</li>
<li>rec not ACK</li>
<li>not rec</li>
</ul>
</li>
</ul>
<h2 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h2><p>防止过多数据注入到网络，可以使网络中的路由器或链路不过载</p>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><ul>
<li>慢开始， 拥塞控制</li>
<li>快重传，快恢复</li>
</ul>
<h4 id="慢开始-慢启动"><a href="#慢开始-慢启动" class="headerlink" title="慢开始 慢启动"></a>慢开始 慢启动</h4><ul>
<li>发送方维持一个 拥塞窗口， 拥塞窗口和接收方共同决定发送窗口</li>
<li>先发送1字节的试探报文</li>
<li>当收到第一个字节的确认后，发送2字节报文</li>
<li>2 ack， send 4 bit data. 2^n</li>
<li>达到慢开始门限<ul>
<li>cwnd &lt; ssthresh 慢开始算法</li>
<li>cwnd &gt; ssthresh ,停止慢开始算法，改用拥塞避免算法</li>
<li>cwnd = ssthresh 都可以</li>
</ul>
</li>
</ul>
<h4 id="拥塞避免算法"><a href="#拥塞避免算法" class="headerlink" title="拥塞避免算法"></a>拥塞避免算法</h4><ul>
<li>每经过一个往返时间rtt则把发送方拥塞窗口+1</li>
<li>网络拥塞时（李儒丢包），<ul>
<li>慢开始门限设为原先一半</li>
<li>cwnd = 1</li>
<li>执行慢开始算法</li>
</ul>
</li>
</ul>
<h4 id="快重传-快回复"><a href="#快重传-快回复" class="headerlink" title="快重传 快回复"></a>快重传 快回复</h4><ul>
<li>快重传<ul>
<li>接收方 丢失包<ul>
<li>后续包继续发送针对该包的重传请求</li>
</ul>
</li>
<li>发送方<ul>
<li>接收到3个一样的确认 就知道该包出现错误，立刻重传该包</li>
</ul>
</li>
</ul>
</li>
<li>快恢复<ul>
<li>慢开始门限减半</li>
<li>cwnd设为门限减半后的数值</li>
<li>拥塞避免算法（高起点，线性增长）</li>
</ul>
</li>
</ul>
<h2 id="网络模型"><a href="#网络模型" class="headerlink" title="网络模型"></a>网络模型</h2><h3 id="OSI模型"><a href="#OSI模型" class="headerlink" title="OSI模型"></a>OSI模型</h3><ul>
<li>应用层</li>
<li>表示层</li>
<li>会话层</li>
<li>网络层</li>
<li>传输层</li>
<li>链路层</li>
<li>物理层</li>
</ul>
<h3 id="TCP-IP模型"><a href="#TCP-IP模型" class="headerlink" title="TCP/IP模型"></a>TCP/IP模型</h3><ul>
<li>应用层 报文 message</li>
<li>传输层 报文段 segment</li>
<li>网络层 分组 packet</li>
<li>链路层 帧 frame</li>
<li>物理层 PDU bit</li>
</ul>
<h2 id="3次握手"><a href="#3次握手" class="headerlink" title="3次握手"></a>3次握手</h2><p>Three way handshake ， 建立tcp连接</p>
<ul>
<li>客户端发送 SYN包，进入SYN-SEND状态，等待服务器确认</li>
<li>服务器 收到SYN包，确认客户的sYN，自己也发送一个SYN-ACK包，进入SYN-RECV状态</li>
<li>客户端收到 SYN-ACK包，发生ACK包，发送完毕，客服端和服务器进入ESTABLISHED状态，完成3次握手，</li>
</ul>
<h3 id="SYN攻击"><a href="#SYN攻击" class="headerlink" title="SYN攻击"></a>SYN攻击</h3><p>Server发送SYN-ACK后，收到client的ACK之前的TCP连接称为TCP半连接 half-open connect</p>
<ul>
<li>server<ul>
<li>SYN-RECV</li>
</ul>
</li>
</ul>
<p>等待client确认， 需要不断重发超时，导致正常的SYN因为队列满而被丢弃</p>
<h2 id="4次挥手"><a href="#4次挥手" class="headerlink" title="4次挥手"></a>4次挥手</h2><p>Four-way wavehand。</p>
<ul>
<li>Client send FIN ,Client =&gt; FIN_WAIT_1</li>
<li>Server get FIN ,send ACK, Server =&gt; CLOSE_WAIT</li>
<li>Server send FIN, Server =&gt; LAST_ACK</li>
<li>Client get FIN, Client =&gt; TIME_WAIT, send ACK , Server =&gt; CLOSED</li>
</ul>
<p>##为什么建立连接是三次握手，而关闭连接却是四次挥手呢？</p>
<h2 id="为什么TIME-WAIT状态需要经过2MSL-最大报文段生存时间-才能返回到CLOSE状态"><a href="#为什么TIME-WAIT状态需要经过2MSL-最大报文段生存时间-才能返回到CLOSE状态" class="headerlink" title="为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态"></a>为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态</h2><p>一、保证TCP协议的全双工连接能够可靠关闭<br>二、保证这次连接的重复数据段从网络中消失</p>
<p>参考：<br><a href="https://www.jianshu.com/p/ef892323e68f" target="_blank" rel="noopener">1</a><br><a href="https://zhuanlan.zhihu.com/p/33889997" target="_blank" rel="noopener">2</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/network/" rel="tag"># network</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/14/myblog/Spring2vue-my-code-life-4-about-android/" rel="prev" title="Spring2vue-my-code-life-4-about-android">
      <i class="fa fa-chevron-left"></i> Spring2vue-my-code-life-4-about-android
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/22/Java-%E4%B8%8EJavaScript-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E4%B8%8E%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA/" rel="next" title="Java 与JavaScript 内存泄漏与内存溢出">
      Java 与JavaScript 内存泄漏与内存溢出 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#TCP"><span class="nav-number">1.</span> <span class="nav-text">TCP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#滑动窗口"><span class="nav-number">1.1.</span> <span class="nav-text">滑动窗口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拥塞控制"><span class="nav-number">1.2.</span> <span class="nav-text">拥塞控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用方法"><span class="nav-number">1.2.1.</span> <span class="nav-text">常用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#慢开始-慢启动"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">慢开始 慢启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#拥塞避免算法"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">拥塞避免算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#快重传-快回复"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">快重传 快回复</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络模型"><span class="nav-number">1.3.</span> <span class="nav-text">网络模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OSI模型"><span class="nav-number">1.3.1.</span> <span class="nav-text">OSI模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-IP模型"><span class="nav-number">1.3.2.</span> <span class="nav-text">TCP&#x2F;IP模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3次握手"><span class="nav-number">1.4.</span> <span class="nav-text">3次握手</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SYN攻击"><span class="nav-number">1.4.1.</span> <span class="nav-text">SYN攻击</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4次挥手"><span class="nav-number">1.5.</span> <span class="nav-text">4次挥手</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么TIME-WAIT状态需要经过2MSL-最大报文段生存时间-才能返回到CLOSE状态"><span class="nav-number">1.6.</span> <span class="nav-text">为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Kfdykme</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">75</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kfdykme</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
